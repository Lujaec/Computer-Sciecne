- [데이터베이스](#데이터베이스)

  - 데이터베이스를 사용하는 이유
    - 파일 시스템의 문제점
  - 데이터베이스가 데이터 무결성을 지키는 방식

- [트랜잭션](#트랜잭션)

  - 트랜잭션의 특성
  - 트랜잭션을 사용할 때 주의할 점

- 정규화

  - 정규화 탄생 배경
  - 정규화란 무엇인가
  - 정규화의 종류
  - 정규화의 장단점

- Index
  - Index 란 무엇인가
  - Index 의 자료구조
  - Primary index vs Secondary index
  - Composite index
  - Index 의 성능과 고려해야할 사항
- 교착상태

  - 교착상태란 무엇인가
  - 교착상태의 예(MySQL)
  - 교착 상태의 빈도를 낮추는 방법

- Statement vs PreparedStatement
- NoSQL
  - 정의
  - CAP 이론
    - 일관성
    - 가용성
    - 네트워크 분할 허용성
  - 저장방식에 따른 분류
    - Key-Value Model
    - Document Model
    - Column Model

# 데이터베이스

### 데이터베이스를 사용하는 이유

데이터베이스 이전에는 파일 시스템으로 데이터를 관리하였다. 이때 파일 시스템의 여러 문제가 있었고, 이를 보완하고 효율적으로 데이터를 관리하고자 데이터베이스를 사용한다.

**파일 시스템의 문제점**

    파일 시스템은 데이터 무결성을 보장할 수 없다는 치명적인 문제를 가지고 있으며, **데이터 무결성**은 데이터의 정확성, 일관성, 신뢰성을 유지하는 것을 의미한다. 그리고 아래와 같은 이유로 무결성이 훼손된다.

    1. 데이터 중복과 불일치

    파일 시스템에서는 데이터를 파일 단위로 관리하며, 통합적으로 관리하지않는다. 이에 따라, 동일한 데이터를 여러 파일에 중복하여 저장하는 경우가 생기게 되며, 한 파일의 데이터가 수정되더라도 다른 파일에 반영되지 않아 불일치 문제가 생겼다.

    2. 동시성 문제

    여러 사용자가 동시에 파일에 접근하거나 데이터를 수정하는 경우, 파일 시스템은 충돌을 방지하거나 동시성을 관리하는 기능이 부족하다.

    이 외에도 파일 시스템에 여러 문제가 존재하지만, 데이터 베이스가 파일 시스템의 문제를 보완하는 것중 가장 중요한 사항은 데이터 무결성을 지키기 위해서라고 생각한다.

### 데이터베이스가 데이터 일관성을 지키는 방식

데이터베이스는 파일 시스템에서 지켜지지 않던 데이터 무결성을 제약 조건, 트랜잭션, 정규화, 동시성 제어를 통해 지킨다.

**제약조건**

데이터베이스에는 일반적으로 무결성을 위해 여러 제약 조건이 존재한다. 대표적으로 개체 무결성 제약조건, 키 제약조건, 참조 무결성 제약조건, 도메인 제약조건이 있다.

`개체 무결성 제약조건`: 각 테이블에서 행은 고유하게 식별 되어야 하는 조건이며 이를 위해 키 제약조건에 의존한다.

`키 제약조건`: 각 테이블은 중복되지 않는 기본키를 가지며 NULL 값을 가질 수 없다.

`참조 무결성 제약 조건`: 외래 키는 참조하는 테이블으 기본 키에 해당하는 값을 가져야 하며, NULL 값을 가질 수 없다.

`도메인 제약 조건`: 속성값은 반드시 정의된 도메인(하나의 속성이 가질 수 있는 값의 타입과 범위)만을 가진다.

**트랜잭션**

데이터베이스는 트랜잭션 단위로 작업을 실행한다. 트랜잭션에는 여러 작업들이 묶여있으며, `ACID` 특성을 통해 데이터 무결성을 보장한다.

`Atomicity(원자성)`: 트랜잭션에 묶여있는 작업들은 모두 성공하거나 모두 실피해거나 둘 중 하나로 선택되어야한다. 즉, 트랜잭션의 일부의 작업만 성공하거나 실패하는 상황은 발생하지 않는다.

`Consistency(일관성)`: 트랜잭션이 실행된 후에도, 기존의 제약조건을 만족해야한다.

`Isolation(격리성)`: 여러 트랜잭션이 동시에 실행될 떄, 각 트랜잭션은 서료 영향을 미치지 않아야 한다. 이는 동시성 제어와 밀접한 관련이 있다.

`Durability (지속성)`: 트랜잭션이 성공적으로 완료되면, 시스템 장애가 발생하더라도 그 결과는 영구적으로 보존되어야 한다.

**정규화**

정규화는 데이터 베이스 설계 과정에서, 각 테이블간 데이터 이상 (data anormaly)을 제거하기 위해, 데이터 중복을 최소화하고 하나으 테이블을 여러 테이블로 쪼개는 작업이다.

**동시성 제어**

데이터베이스에서는 락(Lock)과 격리수준(Isolation Level)을 통해 여러 사용자가 동시에 데이터를 수정할 떄 발생하는 문제를 해결한다. 격리수준이 락 생성을 결정한다.

`락(Lock)`: 하나의 트랜잭션이 데이터에 접근하는 동안 다른 트랜잭션이 해당 데이터에 접근하지 못하게 막는다.
`격리수준(Isolation Level)`: 트랜잭션이 다른 트랜잭션과 어떻게 상호작용할지 정의하는 규칙이다. 격리 수준이 높을 수록 트랜잭션 간의 충돌은 방지되지만, 성능이 떨어질 수 있다.

### 트랜잭션

- 트랜잭션(Transaction)이란 무엇인가?
  - 트랜잭션과 Lock
  - 트랜잭션의 특성
  - 트랜잭션을 사용할 때 주의할 점

트랜잭션은 데이터베이스에서 사용하는 작업의 논리적 단위이다. 트랜잭션은 여러 가지의 쿼리문으로 구성될 수 있으며, 트랜잭션의 결과는 모든 쿼리문이 성공하거나, 모든 쿼리문이 실패하거나 둘 중 하나가 된다. 또한 데이터 무결성을 지키기 위해 트랜잭션 ACID 규칙을 따른다.

`Atomicity(원자성)`: 트랜잭션에 묶여있는 작업들은 모두 성공하거나 모두 실피해거나 둘 중 하나로 선택되어야한다. 즉, 트랜잭션의 일부의 작업만 성공하거나 실패하는 상황은 발생하지 않는다.

`Consistency(일관성)`: 트랜잭션이 실행된 후에도, 기존의 제약조건을 만족해야한다.

`Isolation(격리성)`: 여러 트랜잭션이 동시에 실행될 떄, 각 트랜잭션은 서료 영향을 미치지 않아야 한다. 이는 동시성 제어와 밀접한 관련이 있다.

`Durability (지속성)`: 트랜잭션이 성공적으로 완료되면, 시스템 장애가 발생하더라도 그 결과는 영구적으로 보존되어야 한다.

**트랜잭션을 사용할 때 주의할 점**
트랜잭션을 수행하기 위해서는 어플리케이션에서 데이터베이스의 커넥션을 획득해야한다. 그리고 데이터베이스의 커넥션은 제한적이다.따라서 한 커넥션에서 트랜잭션이 오랜 시간동안 끝나지 않는 다면, 다른 작업을 처리하기 위한 커넥션의 여유가 줄어든다. **그리고 이로인해, 커넥션을 가져가기 위해 기다려야 하는 상황이 발생할 수도 있다.** 다음의 예로 설명할 수 있다.

    문제 예시

    1) 처리 시작
    => 데이터베이스 커넥션 생성
    => 트랜잭션 시작
    2) 사용자의 로그인 여부 확인
    3) 사용자의 글쓰기 내용의 오류 여부 확인
    4) 첨부로 업로드된 파일 확인 및 저장
    5) 사용자의 입력 내용을 DBMS에 저장
    6) 첨부 파일 정보를 DBMS에 저장
    7) 저장된 내용 또는 기타 정보를 DBMS에서 조회
    8) 게시물 등록에 대한 알림 메일 발송
    9) 알림 메일 발송 이력을 DBMS에 저장
        <= 트랜잭션 종료 (COMMIT)
        <= 데이터베이스 커넥션 반납
    10) 처리완료

    문제점
    불필요한 작업을 트랜잭션에 포함
        - 2,3,4 과정은 DBMS로 작업하는 과정이 아님에도 트랜잭션에 포함되어 있음
        - 7번 작업은 DBMS로 하는 작업이지만, 조회작업이므로 트랜잭션에 포함될 필요는 없음

    트랜잭션 내부에서 다른 서버와 통신
        - 현재 트랜잭션 과정에 메일을 발송하고 있는데, 메일 발송 실패시 트랜잭션 실패로 간주되어 롤백이 진행됨

    개선후

    1) 처리 시작
    2) 사용자의 로그인 여부 확인
    3) 사용자의 글쓰기 내용의 오류 여부 확인
    4) 첨부로 업로드된 파일 확인 및 저장
        => 데이터베이스 커넥션 생성
        => 트랜잭션 시작
    5) 사용자의 입력 내용을 DBMS에 저장
    6) 첨부 파일 정보를 DBMS에 저장
        <= 트랜잭션 종료 (COMMIT)
    7) 저장된 내용 또는 기타 정보를 DBMS에서 조회
    8) 게시물 등록에 대한 알림 메일 발송
        => 트랜잭션 시작
    9)  알림 메일 발송 이력을 DBMS에 저장
        <= 트랜잭션 종료 (COMMIT)
        <= 데이터베이스 커넥션 반납
    10) 처리완료

    데이터베이스 커넥션을 가지고 있는 범위와 트랜잭션이 활성화돼 있는 프로그램의 범위를 최소화 해야한다는 것이 중요.

# 레퍼런스

박은빈. (2021). Real MySQL 8.0. 위키북스.
